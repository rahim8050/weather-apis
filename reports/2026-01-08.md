# Daily Report — DRF Backend (weather-apis)
**Date:** 2026-01-08 (EAT)

## Done
- Reproduced and diagnosed HMAC signing failure in local smoke test:
  - `TypeError: key: expected bytes or bytearray, but got 'str'` (Python 3.12 `hmac.new` key type strictness).
- Confirmed fix direction: HMAC secret must be converted to **bytes** before signing.
- Drafted a production-safe secret parsing approach to support common formats:
  - hex (matches current-looking secret),
  - base64,
  - fallback UTF-8.
- Prepared Codex prompts to extract the **exact** header contract + canonicalization rules from DRF source (no guessing).

## In progress
- Confirming the authoritative HMAC request headers + signature rules from DRF code for:
  - `POST /api/v1/integrations/token/`
- Aligning secret format expectations between Nextcloud provisioning output and DRF verification (hex vs base64 vs UTF-8).

## Next
- Run Codex task: “Extract exact HMAC headers + curl smoke test” and use the returned snippet locally.
- Implement DRF-side HMAC secret handling fix (if not already present):
  - accept `str|bytes`,
  - decode secret to bytes safely (hex/base64).
- Add minimal unit tests for secret parsing + signature stability (golden vector).
- Rotate any credentials that were exposed during debugging, then re-provision/store clean values.
- Add a short `docs/integrations/hmac.md` documenting:
  - required headers,
  - canonical string order,
  - signature encoding,
  - secret format/decoding rules.

## Blockers
- Need DRF source confirmation (via Codex or direct code inspection) of:
  - exact header names required,
  - canonicalization details (path/query/body hash),
  - signature encoding (hex vs base64).

## Links
- Local token smoke-test snippet (terminal) — pending “correct headers” from DRF source.
- Relevant module: `integrations/hmac.py` (signature + canonicalization helpers).

