# Daily Report — DRF Backend (weather-apis)
**Date:** 2026-01-07 (EAT)

## Done
- Diagnosed why `source .env` fails in bash:
  - `.env` contains unquoted special characters (e.g., `)`), so it’s valid for dotenv-style loaders but not safe to `source` directly.
- Confirmed HMAC clients JSON validation intent:
  - Env var must exist, be valid JSON, be a non-empty object, and contain non-empty string `client_id -> base64_secret` entries.
- Re-aligned integration expectations with Nextcloud side:
  - Token bootstrap is **POST**, and response contract should remain consistent (`ok/status/message` + structured errors).

## In progress
- Tightening DRF verification to match Nextcloud signing exactly (method + path + query + body hashing + headers).
- Preparing endpoint + tests to eliminate 403 drift (canonicalization mismatch, wrong verb, skew/replay rules).

## Next
- Implement/verify `/api/v1/` integration endpoints:
  - Token mint (HMAC-auth) returning `expires_in`
  - Whoami/health used by Nextcloud “Test connection”
- Add integration tests:
  - Bad signature, stale/future timestamp, replayed nonce, body tamper, rate-limit
- Add per-client throttling + consistent structured errors (`code`, `message`, `details`)
- Run gates and commit:
  - Ruff / MyPy / Bandit / Pytest

## Blockers
- `.env` format mismatch for bash `source` (needs safe dotenv loading or quoting/escaping).

## Links
- Env contract: `INTEGRATION_HMAC_CLIENTS_JSON`
- Planned API base path: `/api/v1/`
- Validation focus: canonical HMAC verification + replay/skew + throttling
